<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Data Gaps Demo</title>

    <!-- CSS Framework -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@1.0.2/css/bulma.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma-tooltip@3.0.2/dist/css/bulma-tooltip.min.css">

    <!-- jQuery -->
    <script src="https://code.jquery.com/jquery-3.7.1.min.js" integrity="sha256-/JqT3SQfawRcv/BIHPThkBvs0OEvtFFmqPF/lYI/Cxo=" crossorigin="anonymous"></script>

    <!-- jQuery Mark -->
    <script src="https://cdn.jsdelivr.net/npm/mark.js@8.11.1/dist/jquery.mark.min.js"></script>

    <!-- Chosen -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/chosen/1.8.7/chosen.jquery.min.js" integrity="sha512-rMGGF4wg1R73ehtnxXBt5mbUfN9JUJwbk21KMlnLZDJh7BkPmeovBuddZCENJddHYYMkCh9hPFnPmS9sspki8g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/chosen/1.8.7/chosen.min.css" integrity="sha512-yVvxUQV0QESBt1SyZbNJMAwyKvFTLMyXSyBHDO4BG5t7k/Lw34tyqlSDlKIrIENIzCl+RVUNjmCPG+V/GMesRw==" crossorigin="anonymous" referrerpolicy="no-referrer" />
  </head>
  <body>
    <section class='section'>
      <div class='container'>
        <h1 class="title">Data Gaps Template</h1>

<div class="content">
  <p>
    To fully explore how this template works, follow the instructions in
    <a
      href="https://github.com/climatechange-ai/data-gaps-template/blob/main/README.md"
      >the README</a
    >.
  </p>
  <p>
    <a
      href="https://airtable.com/appY2hJvi0WWoFOPx/pagmTyuvNXMeVZMMS/form"
      target="_blank"
      class="button is-info"
      >New Data Gap</a
    >
  </p>
</div>

<div id="search-wrapper">
  <div class="columns">
    <div class="column">
      <div class="field">
        <label class="label">Text Search</label>
        <div class="control">
          <input
            class="input is-small"
            id="text-search"
            placeholder="Enter search terms..."
            type="search"
          />
        </div>
      </div>
    </div>
    <div class="column">
      <div class="field">
        <label class="label"
          >Data Gap Types (<a href="taxonomy">definitions</a>)</label
        >
        <div class="control is-expanded">
          <select multiple id="gap-types"></select>
        </div>
      </div>
    </div>
    <div class="column">
      <div class="field">
        <label class="label">Data Modalities</label>
        <div class="control is-expanded">
          <select multiple id="modalities"></select>
        </div>
      </div>
    </div>
    <div class="column">
      <div class="field">
        <label class="label">Sectors</label>
        <div class="control is-expanded">
          <select multiple id="sectors"></select>
        </div>
      </div>
    </div>
    <div class="column is-narrow">
      <button
        class="button is-small clear-filters"
        id="clear-filters"
        style="display: none; margin-top: 36px"
      >
        Clear filters
      </button>
    </div>
  </div>

  <div class="tabs is-boxed is-large">
    <ul>
      <li data-show="by-use-case" class="is-active">
        <a href="javascript:void(0)">By Use Case</a>
      </li>
      <li data-show="by-dataset">
        <a href="javascript:void(0)">By Dataset or Data Wish</a>
      </li>
    </ul>
  </div>

  <br />
</div>

<!-- control which tab displays -->
<div id="visibility-toggle" class="by-use-case">
  <!-- use case tab -->
  <div id="by-use-case">
    <!-- table of use cases -->
    <table class="filterable-table table is-bordered">
      <thead>
        <th>Use Case</th>
        <th>Gap Types</th>
        <th>Sectors</th>
      </thead>
      <tbody>
          

        <!-- use case row -->
        <tr
          id="better-public-policy"
          class="data-gaps-details use-case-row"
          data-sectors="["recUD3T8Vxf1E7wVs"]"
        >
          <td>
            Better Public Policy

            <details>
              <summary>Details (click to expand)</summary>

               <p>A lot of our public policy isnâ€™t based on good, reliable data. That should change.</p> 

              <table class="table is-bordered">
                <thead>
                  <tr>
                    <th>Dataset</th>
                    <th>Data Gap Summary</th>
                  </tr>
                </thead>
                <tbody>
                      

                  <!-- data gap row -->
                  <tr
                    class="data-gap-row"
                    data-types="["W:"]"
                    data-existence="Wish"
                    data-modalities="["Timeseries","Tabular","Text"]"
                  >
                    <td>
                      <a
                        class="view-data-gap"
                        href="javascript:void(0)"
                        data-gap="better-public-policy-boiler-data"
                        >Boiler Data</a
                      >
                    </td>
                    <td>
                      


  <p>We need better data on the UKâ€™s gas boilers to help us achieve net zero and ensure landlords are keeping their tenants safe. The Government could achieve this by requiring gas safety certificates and boiler service reports to be registered centrally, just like energy performance certificates.</p>


<button class='button is-info view-data-gap' data-gap='better-public-policy-boiler-data'>
  More details
</button>

<a class='button is-info' href='https://airtable.com/appY2hJvi0WWoFOPx/pagBcFCIqhKBjQLW6/form?prefill_Data+Gap=better-public-policy-boiler-data' target='_blank'>
  Give feedback
</a>

<div class='modal' data-gap='better-public-policy-boiler-data'>
  <div class='modal-background'></div>
  <div class='modal-card'>
    <header class='modal-card-head'>
      <p class='modal-card-title' style='margin: 0'>
        
          <a class='details-link' href='#better-public-policy' data-to='by-use-case'>Better Public Policy</a>
          &nbsp;
          &gt;
          &nbsp;
          <a class='details-link' href='#boiler-data' data-to='by-dataset'>Boiler Data</a>
        
      </p>
      <button class="modal-close delete" aria-label="close"></button>
    </header>
    <section class="modal-card-body">
      
        <p>We need better data on the UKâ€™s gas boilers to help us achieve net zero and ensure landlords are keeping their tenants safe. The Government could achieve this by requiring gas safety certificates and boiler service reports to be registered centrally, just like energy performance certificates.</p>
      

      
        <table>
          <thead><tr><th>Data Gap Type</th><th>Data Gap Details</th></tr></thead>
          <tbody>
            
              
              
              
              <tr>
                <td style='white-space: nowrap' class='gap-type' title="Dataset does not exist">W: Wish</td>
                <td><p>We donâ€™t know which homes have the oldest, most polluting boilers. So itâ€™s much harder for the government to target incentives at the homeowners most in need. Previous incentive schemes have a <a target="_blank" href="https://www.nao.org.uk/press-releases/green-homes-grant/">woeful track record</a>.</p></td>
              </tr>
            
          </tbody>
        </table>
      
    </section>
    <footer class='modal-card-foot'>
      <div class="buttons">
        <a class='button is-info' href='https://airtable.com/appY2hJvi0WWoFOPx/pagBcFCIqhKBjQLW6/form?prefill_Data+Gap=better-public-policy-boiler-data' target='_blank'>
          Give feedback
        </a>

        <button class='button modal-close-button'>Back</button>
      </div>
    </footer>
  </div>
</div>

                    </td>
                  </tr>
                  
                </tbody>
              </table>
            </details>
          </td>
          <td>
            <div class="types"></div>
          </td>
          <td>
            <div class="sectors"></div>
          </td>
        </tr>
          

        <!-- use case row -->
        <tr
          id="improving-legal-outcomes"
          class="data-gaps-details use-case-row"
          data-sectors="["rec8AGIw134PanOsZ","recUD3T8Vxf1E7wVs"]"
        >
          <td>
            Improving Legal Outcomes

            <details>
              <summary>Details (click to expand)</summary>

               <p>Legal outcomes in the UK system could be improved. Filling data gaps would be helpful to improve it.</p> 

              <table class="table is-bordered">
                <thead>
                  <tr>
                    <th>Dataset</th>
                    <th>Data Gap Summary</th>
                  </tr>
                </thead>
                <tbody>
                      

                  <!-- data gap row -->
                  <tr
                    class="data-gap-row"
                    data-types="["S1","U2"]"
                    data-existence="Existing"
                    data-modalities="["Tabular"]"
                  >
                    <td>
                      <a
                        class="view-data-gap"
                        href="javascript:void(0)"
                        data-gap="improving-legal-outcomes-unrepresented-defendants"
                        >Unrepresented Defendants</a
                      >
                    </td>
                    <td>
                      


  <p>Unrepresented defendants can face harsher justice outcomes, are more likely to have negative court experiences and typically slow down hearings. Despite public interest in this data, no official data is published on unrepresented defendants.</p>


<button class='button is-info view-data-gap' data-gap='improving-legal-outcomes-unrepresented-defendants'>
  More details
</button>

<a class='button is-info' href='https://airtable.com/appY2hJvi0WWoFOPx/pagBcFCIqhKBjQLW6/form?prefill_Data+Gap=improving-legal-outcomes-unrepresented-defendants' target='_blank'>
  Give feedback
</a>

<div class='modal' data-gap='improving-legal-outcomes-unrepresented-defendants'>
  <div class='modal-background'></div>
  <div class='modal-card'>
    <header class='modal-card-head'>
      <p class='modal-card-title' style='margin: 0'>
        
          <a class='details-link' href='#improving-legal-outcomes' data-to='by-use-case'>Improving Legal Outcomes</a>
          &nbsp;
          &gt;
          &nbsp;
          <a class='details-link' href='#unrepresented-defendants' data-to='by-dataset'>Unrepresented Defendants</a>
        
      </p>
      <button class="modal-close delete" aria-label="close"></button>
    </header>
    <section class="modal-card-body">
      
        <p>Unrepresented defendants can face harsher justice outcomes, are more likely to have negative court experiences and typically slow down hearings. Despite public interest in this data, no official data is published on unrepresented defendants.</p>
      

      
        <table>
          <thead><tr><th>Data Gap Type</th><th>Data Gap Details</th></tr></thead>
          <tbody>
            
              
              
              
              <tr>
                <td style='white-space: nowrap' class='gap-type' title="Data volume is insufficient for intended tasks">S1: Sufficiency > Insufficient Volume</td>
                <td><p>There isnâ€™t enough data on unrepresented defendants. This represents a <strong>big problem</strong> for improving legal outcomes.</p></td>
              </tr>
            
              
              
              
              <tr>
                <td style='white-space: nowrap' class='gap-type' title="Data is scattered and requires consolidation">U2: Usability > Aggregation</td>
                <td><p>Data on unrepresented defendants, where it exists, isnâ€™t standardized. Itâ€™s really hard to compare attributes and outcomes across location.</p></td>
              </tr>
            
          </tbody>
        </table>
      
    </section>
    <footer class='modal-card-foot'>
      <div class="buttons">
        <a class='button is-info' href='https://airtable.com/appY2hJvi0WWoFOPx/pagBcFCIqhKBjQLW6/form?prefill_Data+Gap=improving-legal-outcomes-unrepresented-defendants' target='_blank'>
          Give feedback
        </a>

        <button class='button modal-close-button'>Back</button>
      </div>
    </footer>
  </div>
</div>

                    </td>
                  </tr>
                  
                </tbody>
              </table>
            </details>
          </td>
          <td>
            <div class="types"></div>
          </td>
          <td>
            <div class="sectors"></div>
          </td>
        </tr>
        
      </tbody>
    </table>

    <div class="no-records" style="display: none">
      <p>
        No records found! Try
        <a href="javascript:void(0)" class="clear-filters">clearing filters</a>,
        or
        <a
          href="https://airtable.com/appY2hJvi0WWoFOPx/pagmTyuvNXMeVZMMS/form"
          target="_blank"
          >contribute a new data gap</a
        >.
      </p>
    </div>
  </div>

  <!-- dataset tab -->
  <div id="by-dataset">
    <!-- table of datasets -->
    <table class="filterable-table table is-bordered">
      <thead>
        <th>Dataset</th>
        <th>Gap Types</th>
        <th>Modalities</th>
        <th>Sectors</th>
      </thead>
      <tbody>
          

        <!-- dataset row -->
        <tr
          id="boiler-data"
          class="data-gaps-details dataset-row"
          data-sectors="["recoCHzI27qe9Xzd9"]"
          data-existence="Wish"
          data-modalities="["Timeseries","Tabular","Text"]"
        >
          <td>
            Boiler Data

            <details>
              <summary>Details (click to expand)</summary>

               <p>This is a <strong><em>longer description.</em></strong></p>  
              <p>
                <a
                  href="https://www.centreforpublicdata.org/boiler-data"
                  class="button is-info"
                  target="_blank"
                  >View dataset</a
                >
              </p>
              

              <table class="table is-bordered">
                <thead>
                  <tr>
                    <th>Use Case</th>
                    <th>Data Gap Summary</th>
                  </tr>
                </thead>
                <tbody>
                      

                  <!-- data gap row -->
                  <tr
                    class="data-gap-row"
                    data-types="["W:"]"
                  >
                    <td>
                      <a
                        class="view-data-gap"
                        href="javascript:void(0)"
                        data-gap="better-public-policy-boiler-data"
                        >Better Public Policy</a
                      >
                    </td>
                    <td>
                      


  <p>We need better data on the UKâ€™s gas boilers to help us achieve net zero and ensure landlords are keeping their tenants safe. The Government could achieve this by requiring gas safety certificates and boiler service reports to be registered centrally, just like energy performance certificates.</p>


<button class='button is-info view-data-gap' data-gap='better-public-policy-boiler-data'>
  More details
</button>

<a class='button is-info' href='https://airtable.com/appY2hJvi0WWoFOPx/pagBcFCIqhKBjQLW6/form?prefill_Data+Gap=better-public-policy-boiler-data' target='_blank'>
  Give feedback
</a>

<div class='modal' data-gap='better-public-policy-boiler-data'>
  <div class='modal-background'></div>
  <div class='modal-card'>
    <header class='modal-card-head'>
      <p class='modal-card-title' style='margin: 0'>
        
          <a class='details-link' href='#boiler-data' data-to='by-dataset'>Boiler Data</a>
          &nbsp;
          &gt;
          &nbsp;
          <a class='details-link' href='#better-public-policy' data-to='by-use-case'>Better Public Policy</a>
        
      </p>
      <button class="modal-close delete" aria-label="close"></button>
    </header>
    <section class="modal-card-body">
      
        <p>We need better data on the UKâ€™s gas boilers to help us achieve net zero and ensure landlords are keeping their tenants safe. The Government could achieve this by requiring gas safety certificates and boiler service reports to be registered centrally, just like energy performance certificates.</p>
      

      
        <table>
          <thead><tr><th>Data Gap Type</th><th>Data Gap Details</th></tr></thead>
          <tbody>
            
              
              
              
              <tr>
                <td style='white-space: nowrap' class='gap-type' title="Dataset does not exist">W: Wish</td>
                <td><p>We donâ€™t know which homes have the oldest, most polluting boilers. So itâ€™s much harder for the government to target incentives at the homeowners most in need. Previous incentive schemes have a <a target="_blank" href="https://www.nao.org.uk/press-releases/green-homes-grant/">woeful track record</a>.</p></td>
              </tr>
            
          </tbody>
        </table>
      
    </section>
    <footer class='modal-card-foot'>
      <div class="buttons">
        <a class='button is-info' href='https://airtable.com/appY2hJvi0WWoFOPx/pagBcFCIqhKBjQLW6/form?prefill_Data+Gap=better-public-policy-boiler-data' target='_blank'>
          Give feedback
        </a>

        <button class='button modal-close-button'>Back</button>
      </div>
    </footer>
  </div>
</div>

                    </td>
                  </tr>
                  
                </tbody>
              </table>
            </details>
          </td>
          <td>
            <div class="types"></div>
          </td>
          <td>
            <div class="modalities"></div>
          </td>
          <td>
            <div class="sectors"></div>
          </td>
        </tr>
          

        <!-- dataset row -->
        <tr
          id="unrepresented-defendants"
          class="data-gaps-details dataset-row"
          data-sectors="["rec8AGIw134PanOsZ"]"
          data-existence="Existing"
          data-modalities="["Tabular"]"
        >
          <td>
            Unrepresented Defendants

            <details>
              <summary>Details (click to expand)</summary>

               <p>This is a longer introduction to the problem of unrepresented defendants.</p>

<p>This can have <strong><em>formatting</em></strong> or <a target="_blank" href="https://www.centreforpublicdata.org/">links</a>.</p>  
              <p>
                <a
                  href="https://www.centreforpublicdata.org/blog/understanding-the-unrepresented-the-case-for-better-data-on-legal-representation-in-courts"
                  class="button is-info"
                  target="_blank"
                  >View dataset</a
                >
              </p>
              

              <table class="table is-bordered">
                <thead>
                  <tr>
                    <th>Use Case</th>
                    <th>Data Gap Summary</th>
                  </tr>
                </thead>
                <tbody>
                      

                  <!-- data gap row -->
                  <tr
                    class="data-gap-row"
                    data-types="["S1","U2"]"
                  >
                    <td>
                      <a
                        class="view-data-gap"
                        href="javascript:void(0)"
                        data-gap="improving-legal-outcomes-unrepresented-defendants"
                        >Improving Legal Outcomes</a
                      >
                    </td>
                    <td>
                      


  <p>Unrepresented defendants can face harsher justice outcomes, are more likely to have negative court experiences and typically slow down hearings. Despite public interest in this data, no official data is published on unrepresented defendants.</p>


<button class='button is-info view-data-gap' data-gap='improving-legal-outcomes-unrepresented-defendants'>
  More details
</button>

<a class='button is-info' href='https://airtable.com/appY2hJvi0WWoFOPx/pagBcFCIqhKBjQLW6/form?prefill_Data+Gap=improving-legal-outcomes-unrepresented-defendants' target='_blank'>
  Give feedback
</a>

<div class='modal' data-gap='improving-legal-outcomes-unrepresented-defendants'>
  <div class='modal-background'></div>
  <div class='modal-card'>
    <header class='modal-card-head'>
      <p class='modal-card-title' style='margin: 0'>
        
          <a class='details-link' href='#unrepresented-defendants' data-to='by-dataset'>Unrepresented Defendants</a>
          &nbsp;
          &gt;
          &nbsp;
          <a class='details-link' href='#improving-legal-outcomes' data-to='by-use-case'>Improving Legal Outcomes</a>
        
      </p>
      <button class="modal-close delete" aria-label="close"></button>
    </header>
    <section class="modal-card-body">
      
        <p>Unrepresented defendants can face harsher justice outcomes, are more likely to have negative court experiences and typically slow down hearings. Despite public interest in this data, no official data is published on unrepresented defendants.</p>
      

      
        <table>
          <thead><tr><th>Data Gap Type</th><th>Data Gap Details</th></tr></thead>
          <tbody>
            
              
              
              
              <tr>
                <td style='white-space: nowrap' class='gap-type' title="Data volume is insufficient for intended tasks">S1: Sufficiency > Insufficient Volume</td>
                <td><p>There isnâ€™t enough data on unrepresented defendants. This represents a <strong>big problem</strong> for improving legal outcomes.</p></td>
              </tr>
            
              
              
              
              <tr>
                <td style='white-space: nowrap' class='gap-type' title="Data is scattered and requires consolidation">U2: Usability > Aggregation</td>
                <td><p>Data on unrepresented defendants, where it exists, isnâ€™t standardized. Itâ€™s really hard to compare attributes and outcomes across location.</p></td>
              </tr>
            
          </tbody>
        </table>
      
    </section>
    <footer class='modal-card-foot'>
      <div class="buttons">
        <a class='button is-info' href='https://airtable.com/appY2hJvi0WWoFOPx/pagBcFCIqhKBjQLW6/form?prefill_Data+Gap=improving-legal-outcomes-unrepresented-defendants' target='_blank'>
          Give feedback
        </a>

        <button class='button modal-close-button'>Back</button>
      </div>
    </footer>
  </div>
</div>

                    </td>
                  </tr>
                  
                </tbody>
              </table>
            </details>
          </td>
          <td>
            <div class="types"></div>
          </td>
          <td>
            <div class="modalities"></div>
          </td>
          <td>
            <div class="sectors"></div>
          </td>
        </tr>
        
      </tbody>
    </table>

    <div class="no-records" style="display: none">
      <p>
        No records found! Try
        <a href="javascript:void(0)" class="clear-filters">clearing filters</a>,
        or
        <a
          href="https://airtable.com/appY2hJvi0WWoFOPx/pagmTyuvNXMeVZMMS/form"
          target="_blank"
          >contribute a new data gap</a
        >.
      </p>
    </div>
  </div>
</div>

<style>
  summary {
    cursor: pointer;
  }

  details[open] > summary {
    margin-bottom: 1rem;
  }

  details {
    font-size: 15px;
    margin-top: 5px !important;
    margin-bottom: 5px !important;
    padding: 5px !important;
    border: 1px solid #eee;
    background: #f8f8f8;
  }

  .by-dataset #by-use-case {
    display: none;
  }

  .by-use-case #by-dataset {
    display: none;
  }

  .data-gaps-details > td:first-child {
    width: 75%;
  }

  .filterable-table {
    width: calc(100% - 1px);
  }

  .filterable-table > thead > th {
    white-space: nowrap;
    display: block;
    width: 100%;
    overflow: auto;
    word-break: normal;
    word-break: keep-all;
    -webkit-overflow-scrolling: touch
  }

  .filterable-table th {
      font-weight: bold
  }

  .filterable-table th,.filterable-table td {
      padding: 0.5rem 1rem;
      border: 1px solid #e9ebec
      border-width: 2px !important;
  }

  details, details td, details th {
    font-size: 16px;
  }

  details summary {
    font-size: 18px;
  }

  .tabs ul {
    padding: 0;
  }

  .tabs ul li {
    margin: 0;
  }

  .tabs.is-boxed ul li a {
    color: #4a4a4a;
  }

  .tabs.is-boxed ul li:hover a {
    text-decoration: none;
  }

  .tabs.is-boxed ul li.is-active:hover a {
    cursor: initial;
  }

  .tabs ul li a:not(.is-active) {
    cursor: pointer;
  }

  .modal-card {
    width: calc(100% - 8rem);
    max-width: 1024px;
  }

  p.modal-card-title {
    max-width: 100%;
    display: inline-block;
    overflow: hidden;
    white-space: nowrap;
    text-overflow: ellipsis;
  }

  .modal p, .modal details, .modal .gap-type {
    font-size: 20px;
  }

  .is-icon-tag {
    font-size: 14px !important;
  }
</style>

<script>
  const sectors = {"recoCHzI27qe9Xzd9":{"airtable_id":"recoCHzI27qe9Xzd9","name":"Energy","associated_datasets":["recRqVr5AVjnpiPJh"],"icon":"ðŸ”Œ"},"rec8AGIw134PanOsZ":{"airtable_id":"rec8AGIw134PanOsZ","name":"Legal System","associated_use_cases":["rec9cpZ6HbUZ2slIP"],"associated_datasets":["recPz0swayVMo9sTP"],"icon":"ðŸ‘©â€âš–ï¸"},"recUD3T8Vxf1E7wVs":{"airtable_id":"recUD3T8Vxf1E7wVs","name":"Public Policy","associated_use_cases":["rec9cpZ6HbUZ2slIP","recAf0fpZFhEiJd1S"],"icon":"ðŸ‘¥"}};
  const modalities = {"rectsnaFBdP7KtICO":{"airtable_id":"rectsnaFBdP7KtICO","name":"Audio","icon":"ðŸ”Š"},"rec68iaSQwefsAZ2E":{"airtable_id":"rec68iaSQwefsAZ2E","name":"Geospatial Numeric","icon":"ðŸŒ"},"recuIsqzfrkhbBwvR":{"airtable_id":"recuIsqzfrkhbBwvR","name":"Image","icon":"ðŸ–¼ï¸"},"recYFzMXUXPSEEwyI":{"airtable_id":"recYFzMXUXPSEEwyI","name":"Other","icon":"âž•"},"recUHDKdbh7C2yU2C":{"airtable_id":"recUHDKdbh7C2yU2C","name":"Satellite","icon":"ðŸ›°ï¸"},"recozsT3bzD85yneh":{"airtable_id":"recozsT3bzD85yneh","name":"Simulation","icon":"âš™ï¸"},"recX5jk6gMljKxqPI":{"airtable_id":"recX5jk6gMljKxqPI","name":"Tabular","icon":"ðŸ“Š"},"recZQegbA9QiQnYmz":{"airtable_id":"recZQegbA9QiQnYmz","name":"Text","icon":"ðŸ“"},"recdkhdDqTng8Tque":{"airtable_id":"recdkhdDqTng8Tque","name":"Timeseries","icon":"ðŸ“ˆ"},"recoq1Dre8v9iMOm7":{"airtable_id":"recoq1Dre8v9iMOm7","name":"Vector","icon":"â†—ï¸"},"rec581Yvn7lryUKTR":{"airtable_id":"rec581Yvn7lryUKTR","name":"Video","icon":"ðŸŽ¥"}};

  const sectorIcons = {};
  Object.entries(sectors).forEach(iter => {
    const [sectorId, sector] = iter;
    sectorIcons[sectorId] = sector.icon;
  });

  const modalityIcons = {};
  Object.entries(modalities).forEach(iter => {
    const [modalityId, modality] = iter;
     modalityIcons[modality.name] = modality.icon;
  });

  $(document).ready(() => {
    const updateShowing = (show) => {
      $('.tabs li').removeClass('is-active');
      $(`[data-show='${show}']`).addClass('is-active');
      $('#visibility-toggle').removeClass().addClass(show);

      const url = new URL(window.location.href);
      url.searchParams.set('showing', show);
      window.history.pushState(null, '', url.toString());
    };

    const params = new URLSearchParams(document.location.search);
    if (['by-dataset', 'by-use-case'].includes(params.get('showing'))) {
      updateShowing(params.get('showing'));
    }

    $('.tabs li').click(ev => {
      updateShowing($(ev.currentTarget).data('show'));
    });

    $('.details-link').click(ev => {
      const a = $(ev.currentTarget);
      const target = $(a.attr('href'));
      const showing = a.data('to');
      updateShowing(showing);
      $('.modal').removeClass('is-active');
      target.find('details').attr('open', 'open');
      target[0].scrollIntoView();

      const url = new URL(window.location.href);
      if (url.searchParams.get('gap')) {
        url.searchParams.delete('gap');
        window.history.pushState(null, '', url.toString());
      }
    });

    const sortedVals = (setVar) => {
      const vals = Array.from(setVar);
      vals.sort();
      return vals;
    };

    const details = Array.from(document.getElementsByClassName('data-gaps-details'));
    const allSectors = new Set();

    details.forEach(el => {
      const rowTypes = new Set();

      ($(el).data('sectors') || []).forEach(sector => {
        allSectors.add(sector);
        $(el).find('.sectors').append(`
           <a class='tag is-light is-icon-tag' data-sectors='${sector}' href='javascript:void(0)' title='${sectors[sector].name}'>${sectors[sector].icon}</a>
        `);
      });

      Array.from($(el).find('.data-gap-row')).forEach(row => {
        ($(row).data('types') || []).forEach(type => {
          rowTypes.add(type);
        });
      });
      $(el).attr('data-types', JSON.stringify(sortedVals(rowTypes)));
    });

    sortedVals(allSectors).forEach(sectorId => {
      $("#sectors").append(`<option value='${sectorId}'>${sectorIcons[sectorId]} ${sectors[sectorId].name}</option>`);
    });

    const typeIdsToNames = {};
    const typeIdsToDescs = {};
    const typeNamesToIds = {};
    const gapTypes = {"recdJc6zAwyZVdhaf":{"airtable_id":"recdJc6zAwyZVdhaf","name":"M: Misc/Other","code":"M:","description":"Challenges or gaps that do not fit into the other categories"},"recqxj5X3VgdcEOjW":{"airtable_id":"recqxj5X3VgdcEOjW","name":"O1: Obtainability > Findability","code":"O1","description":"Dataset is not easy to find for humans and/or computers"},"recMT1q0iTuvMXXtg":{"airtable_id":"recMT1q0iTuvMXXtg","name":"O2: Obtainability > Accessibility","code":"O2","description":"Dataset is difficult to access"},"recV8XaU0jkHWiEpm":{"airtable_id":"recV8XaU0jkHWiEpm","name":"R1: Reliability > Quality","code":"R1","description":"Data quality needs to be improved, validated, and/or verified"},"recvgPmtaGbPjoMA4":{"airtable_id":"recvgPmtaGbPjoMA4","name":"R2: Reliability > Provenance","code":"R2","description":"Data integrity needs to be validated/verified due to provenance"},"rec40WCq5huWtH3WP":{"airtable_id":"rec40WCq5huWtH3WP","name":"S1: Sufficiency > Insufficient Volume","where_it's_used":["recUBfs9lj5RO0STf"],"code":"S1","description":"Data volume is insufficient for intended tasks"},"recxBzgmu0DRSxcdU":{"airtable_id":"recxBzgmu0DRSxcdU","name":"S2: Sufficiency > Coverage","code":"S2","description":"Data coverage is limited - e.g., geographically, temporally, or demographically"},"recPYUX7GHErBan4o":{"airtable_id":"recPYUX7GHErBan4o","name":"S3: Sufficiency > Granularity","code":"S3","description":"Data is lacking in granularity/resolution"},"recD0dJn1gMyJzf6u":{"airtable_id":"recD0dJn1gMyJzf6u","name":"S4: Sufficiency > Timeliness","code":"S4","description":"Data is not released promptly or is otherwise out of date"},"rec2i9Vx632cAkSsT":{"airtable_id":"rec2i9Vx632cAkSsT","name":"S5: Sufficiency > Proxy","code":"S5","description":"Data needs to be inferred or simulated"},"recxQ3Tw5QCn4d1u9":{"airtable_id":"recxQ3Tw5QCn4d1u9","name":"S6: Sufficiency > Missing Components","code":"S6","description":"Dataset is missing important variables or types of information"},"recfsueFTcexrqVUr":{"airtable_id":"recfsueFTcexrqVUr","name":"U1: Usability > Structure","code":"U1","description":"Dataset is not machine-readable, well-formatted, and/or interoperable"},"recQ0jwebST7Ath7i":{"airtable_id":"recQ0jwebST7Ath7i","name":"U2: Usability > Aggregation","where_it's_used":["recDDM1tP9umG2lL0"],"code":"U2","description":"Data is scattered and requires consolidation"},"recnC6aMWYIxE5R71":{"airtable_id":"recnC6aMWYIxE5R71","name":"U3: Usability > Usage Rights","code":"U3","description":"Data usage rights are unclear or restrictive"},"recpchiTRT0Odbieu":{"airtable_id":"recpchiTRT0Odbieu","name":"U4: Usability > Documentation","code":"U4","description":"Documentation on data usage requires improvement"},"recHc59Uu2Z44jIpg":{"airtable_id":"recHc59Uu2Z44jIpg","name":"U5: Usability > Pre-processing","code":"U5","description":"Data needs to be processed or cleaned prior to analysis"},"recmfAAPdqVpt0p4y":{"airtable_id":"recmfAAPdqVpt0p4y","name":"U6: Usability > Large Volume","code":"U6","description":"Usability is impeded by large data volume"},"recV4IXysogbmWof9":{"airtable_id":"recV4IXysogbmWof9","name":"W: Wish","where_it's_used":["recDYKODOz00nTHbs"],"code":"W:","description":"Dataset does not exist"}};
    for (let type of Object.values(gapTypes)) {
      typeIdsToNames[type.code] = type.name;
      typeIdsToDescs[type.code] = type.description;
      typeNamesToIds[type.name] = type.code;
    }

    const gapTypesComparator = (a,b) => {
      const ord = "SRUO";
      const idx1 = ord.indexOf(a[0]);
      const idx2 = ord.indexOf(b[0]);
      if (idx1 < idx2) {
        return 1;
      } else if (idx2 < idx1) {
        return -1;
      } else {
        return (a > b) ? 1 : -1;
      }
    };

    const allTypes = new Set();
    details.forEach(el => {
      ($(el).data('types') || []).sort(gapTypesComparator).forEach(typeId => {
        const name = typeIdsToNames[typeId];
        allTypes.add(name);
        $(el).find('.types').append(`
   <a class='tag is-light gap-type is-icon-tag' data-gap-types='${typeId}' title="${name}${typeIdsToDescs[typeId] ? ' ('+typeIdsToDescs[typeId] + ')': ''}" href='javascript:void(0)'>
            ${typeId.replace(':', '')}
          </a>
        `);
      });
    });

    sortedVals(allTypes).sort(gapTypesComparator).forEach(typeName => {
      $('#gap-types').append(`<option value='${typeNamesToIds[typeName]}'>${typeName}</option>`);
    });

    const allModes = new Set();
    Array.from($('.dataset-row')).forEach(el => {
      ($(el).data('modalities') || []).forEach(modality => {
        allModes.add(modality);
        $(el).find('.modalities').append(`
            <a class='tag is-light is-icon-tag' data-modalities='${modality}' href='javascript:void(0)' title='${modality}'>${modalityIcons[modality]}</a>
        `);
      });
    });

    sortedVals(allModes).forEach(modality => {
      $("#modalities").append(`<option value='${modality}'>${modalityIcons[modality]} ${modality}</option>`);
    });

    $("#search-wrapper select").chosen({ width: '100%' });

    let markTimeout = undefined;
    const $tableBody = $('.filterable-table tbody');

    const prepareMark = (textSearch) => {
      if (markTimeout) clearTimeout(markTimeout);
      markTimeout = setTimeout(() => {
        $tableBody.unmark();
        if (textSearch) {
          $tableBody.mark(textSearch);
        }
      }, 100);
    }

    const filterRows = () => {
      const textSearch = $('#text-search').val();
      prepareMark(textSearch);
      const selectedSects = new Set(Array.from($("#sectors").val()));
      const selectedTypes = new Set(Array.from($("#gap-types").val()));
      const selectedModes = new Set(Array.from($("#modalities").val()));
      const filterSets = [selectedSects, selectedTypes, selectedModes];

      $(".filterable-table").show();
      $(".no-records").hide();

      if (filterSets.filter(set => set.size > 0).length === 0 && !textSearch) {
        $('.data-gaps-details').show();
        $('.data-gap-row').show();
        $('#clear-filters').hide();
        return;
      } else {
        $('#clear-filters').show();
      }

      const fullOverlap = (set1, set2) => {
        if (set1.size === 0) return true;
        if (set1.intersection) {
          return set1.intersection(set2).size === set1.size;
        } else {
          for (let s of set1) {
            if (!set2.has(s)) {
              return false;
            }
          }
          return true;
        }
      }

      const matchesAll = (selected, rowVals) => {
        return fullOverlap(selected, new Set([rowVals || []].flat()));
      }

      const matchesFilters = (el) => {
        if (!matchesAll(selectedSects, $(el).data('sectors'))) return false;

        if (textSearch) {
          const elText = $(el).clone().remove('.modal').text().toLowerCase();
          for (let word of textSearch.toLowerCase().split(/\s+/)) {
            if (!elText.includes(word)) {
              return false;
            }
          }
        }

        const gaps = Array.from($(el).find('.data-gap-row'));

        const checkGaps = (selected, key) => {
          const allGapValues = new Set();
          for (let gap of gaps) {
            const gapValues = [$(gap).data(key) || []].flat();
            for (let value of gapValues) allGapValues.add(value);
          }
          return fullOverlap(selected, allGapValues);
        }

        if (!checkGaps(selectedTypes, 'types')) return false;

        if ($(el).hasClass('dataset-row')) {
          if (!matchesAll(selectedModes, $(el).data('modalities'))) return false;
        } else {
          if (!checkGaps(selectedModes, 'modalities')) return false;
        }

        return true;
      }

      let numDatasets = 0;
      let numUseCases = 0;

      details.forEach(el => {
        if (matchesFilters(el)) {
          $(el).show();
          numDatasets += $(el).hasClass('dataset-row');
          numUseCases += $(el).hasClass('use-case-row');
        } else {
          $(el).hide();
        }
      });

      if (numDatasets === 0) {
        $("#by-dataset .filterable-table").hide();
        $("#by-dataset .no-records").show();
      }
      if (numUseCases === 0) {
        $("#by-use-case .filterable-table").hide();
        $("#by-use-case .no-records").show();
      }
    };

    $("#search-wrapper select").change(filterRows);
    $("#text-search").keyup(filterRows);
    $("#text-search").change(filterRows);

    $('.clear-filters').click(() => {
      $("#text-search").val("");
      $("#search-wrapper select").val([]).trigger('chosen:updated').trigger('change');
      setTimeout(() => filterRows, 10);
    });

    $('a.tag').click(ev => {
      for (attr of Array.from(ev.currentTarget.attributes)) {
        if (attr.name.includes('data-')) {
          const key = attr.name.replace('data-', '');
          const select = $(`#${key}`);
          const values = select.val();
          if (!values.includes(attr.value)) {
            values.push(attr.value);
            select.val(values);
            select.trigger('change').trigger('chosen:updated');
          }
        }
      }
    });

    const closeModal = (ev) => {
      $(ev.currentTarget).closest('.modal').removeClass('is-active');
      const url = new URL(window.location.href);
      if (url.searchParams.get('gap')) {
        url.searchParams.delete('gap');
        window.history.pushState(null, '', url.toString());
      }
    };

    $(document).on("click", ".modal-close-button", closeModal);
    $(document).on("click", ".modal-background", closeModal);
    $(document).on("click", ".modal-close", closeModal);

    $('.view-data-gap').click(ev => {
      const btn = $(ev.currentTarget);
      const gapId = btn.data('gap');
      const modal = $(`.modal[data-gap='${gapId}']`);
      modal.addClass('is-active');

      const url = new URL(window.location.href);
      url.searchParams.set('gap', gapId);
      window.history.pushState(null, '', url.toString());
    });

    if (params.get("gap")) {
      const gapId = params.get("gap");
      const parent = $("#" + $(".tabs .is-active").data("show"));
      const modal = parent.find(`.modal[data-gap="${gapId}"]`);
      $(modal).addClass("is-active");
      $(modal).closest("details").attr("open", "open");
    }

    if ($(window.location.hash).length) {
      const target = $(window.location.hash);

      if (target.hasClass('dataset-row')) {
        updateShowing('by-dataset');
      } else if (target.hasClass('use-case-row')) {
        updateShowing('by-use-case');
      }

      target.find('details').attr('open', 'open');
      setTimeout(() => {
        target[0].scrollIntoView();
      }, 100);
    }

    Array.from($('a[title]')).forEach((a) => {
        if ($(a).attr('title')) {
            $(a).attr('data-tooltip', $(a).attr('title').replace(/^\s+|\s+$/gm,''));
            $(a).addClass('has-tooltip-left');
            $(a).addClass('has-tooltip-multiline');
            $(a).attr('title', '');
        }
    });
  });
</script>

      </div>
    </section>
  </body>
</html>
